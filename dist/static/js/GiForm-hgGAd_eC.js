import{d as e,k as l,eZ as a,J as o,b as s,S as d,e_ as t,O as r,e as i,o as u,c as n,w as f,h as p,m as c,g as m,f as h,F as y,j as b,e$ as g,G as v,t as _,r as k,E as w,a as V,_ as x}from"./index-raaeN5sp.js";const C=x(e({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:{span:{xs:24,sm:12}}},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(e,{expose:x,emit:C}){const $=e,B=C,P=l((()=>{const e=a($,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:$.search?"inline":"horizontal",...e}})),F=l((()=>$.gridItemProps)),q=o("formRef"),I=s($.defaultCollapsed),E=d({}),j=e=>({...new Map([["input",{allowClear:!0,placeholder:`请输入${e.label}`,maxLength:20}],["input-number",{placeholder:`请输入${e.label}`}],["textarea",{allowClear:!1,placeholder:`请填写${e.label}`,maxLength:200}],["input-tag",{allowClear:!0,placeholder:`请输入${e.label}`}],["mention",{allowClear:!0,placeholder:`请输入${e.label}`}],["select",{allowClear:!0,placeholder:`请选择${e.label}`,options:E[e.field]||e.options}],["tree-select",{allowClear:!0,placeholder:`请选择${e.label}`}],["cascader",{allowClear:!0,placeholder:`请选择${e.label}`,options:E[e.field]||e.options}],["radio-group",{options:E[e.field]||e.options}],["checkbox-group",{options:E[e.field]||e.options}],["date-picker",{allowClear:!0,placeholder:"请选择日期"}],["time-picker",{allowClear:!0,placeholder:"请选择时间"}]]).get(e.type)||{},...e.props}),O=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,T=e=>"boolean"==typeof e.show?e.show:"function"==typeof e.show?e.show($.modelValue):void 0,z=e=>void 0!==e.hide&&("boolean"==typeof e.hide?e.hide:"function"==typeof e.hide?e.hide($.modelValue):void 0),A=e=>void 0!==e.disabled&&("boolean"==typeof e.disabled?e.disabled:"function"==typeof e.disabled?e.disabled($.modelValue):void 0);$.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request($.modelValue).then((l=>{E[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const L=[];$.columns.forEach((e=>{var l;const a=L.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&L.push(e)}));const R=l((()=>t($.modelValue)));return r(R,((e,l)=>{L.forEach((a=>{if(e[a.field]!==l[a.field]){$.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request($.modelValue).then((e=>{E[l.field]=l.resultFormat?l.resultFormat(e):e.data,E[l.field].map((e=>e.value)).includes($.modelValue[l.field])||B("update:modelValue",Object.assign($.modelValue,{[l.field]:""}))})):l.request&&!e[a.field]&&(E[l.field]=[],B("update:modelValue",Object.assign($.modelValue,{[l.field]:""})))}))}}))})),x({formRef:q}),(e,l)=>{const a=i("a-alert"),o=i("a-form-item"),s=i("a-grid-item"),d=i("icon-search"),t=i("a-button"),r=i("icon-up"),x=i("icon-down"),C=i("a-space"),E=i("a-grid"),L=i("a-form");return u(),n(L,c({ref_key:"formRef",ref:q},m(P),{model:e.modelValue}),{default:f((()=>[p(E,c({class:"w-full","col-gap":8},$.gridProps,{collapsed:m(I)}),{default:f((()=>{var i;return[(u(!0),h(y,null,b(e.columns,(l=>{var d,t;return u(),h(y,{key:l.field},[(void 0!==l.show?T(l):!z(l))?(u(),n(s,c({key:0,ref_for:!0},l.gridItemProps||m(F),{span:l.span||(null==(d=l.gridItemProps)?void 0:d.span)||(null==(t=m(F))?void 0:t.span)}),{default:f((()=>[p(o,c({ref_for:!0},l.formItemProps,{field:l.field,rules:O(l),disabled:A(l)}),g({label:f((()=>["string"==typeof l.label?(u(),h(y,{key:0},[v(_(l.label),1)],64)):(u(),n(k(l.label),{key:1}))])),default:f((()=>[["group-title"].includes(l.type||"")?w(e.$slots,"group-title",{key:1},(()=>[p(a,c({ref_for:!0},l.props),{default:f((()=>[v(_(l.label),1)])),_:2},1040)]),!0):w(e.$slots,l.field,c({key:0,ref_for:!0},{disabled:A(l)}),(()=>[(u(),n(k(`a-${l.type}`),c({ref_for:!0},j(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void B("update:modelValue",Object.assign($.modelValue,{[o]:a}));var a,o}}),g({_:2},[b(null==l?void 0:l.slots,((e,l)=>({name:l,fn:f((l=>["string"==typeof e?(u(),h(y,{key:0},[v(_(e),1)],64)):e?(u(),n(k(e(l)),{key:1})):V("",!0)]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},[b(null==l?void 0:l.formItemSlots,((e,l)=>({name:l,fn:f((()=>["string"==typeof e?(u(),h(y,{key:0},[v(_(e),1)],64)):(u(),n(k(e),{key:1}))]))})))]),1040,["field","rules","disabled"])])),_:2},1040,["span"])):V("",!0)],64)})),128)),$.search?(u(),n(s,c({key:0},m(F),{span:null==(i=m(F))?void 0:i.span,suffix:$.search&&$.suffix}),{default:f((()=>[p(C,{wrap:""},{default:f((()=>[w(e.$slots,"suffix",{},(()=>[p(t,{type:"primary",onClick:l[0]||(l[0]=e=>B("search"))},{icon:f((()=>[p(d)])),default:f((()=>[v(_($.searchBtnText),1)])),_:1}),p(t,{onClick:l[1]||(l[1]=e=>B("reset"))},{default:f((()=>l[3]||(l[3]=[v("重置")]))),_:1}),$.hideFoldBtn?V("",!0):(u(),n(t,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=e=>I.value=!m(I))},{icon:f((()=>[m(I)?(u(),n(x,{key:1})):(u(),n(r,{key:0}))])),default:f((()=>[v(_(m(I)?"展开":"收起"),1)])),_:1}))]),!0)])),_:3})])),_:3},16,["span","suffix"])):V("",!0)]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-5825f779"]]);export{C as _};
