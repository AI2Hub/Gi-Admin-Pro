import{d as e,k as l,J as a,b as o,S as d,eZ as s,O as t,e as r,o as i,c as n,w as u,h as f,m as p,g as c,f as m,F as b,j as h,e_ as v,G as y,t as g,r as _,E as k,a as w,_ as V}from"./index-Ns3PKQ29.js";const x=V(e({__name:"GiForm",props:{modelValue:{},options:{default:()=>({})},columns:{}},emits:["update:modelValue","search","reset"],setup(e,{expose:V,emit:x}){var C;const $=e,q=x,I=l((()=>({grid:{cols:2},gridItem:{span:{xs:2,sm:1}},...$.options}))),F=a("formRef"),j=o((null==(C=$.options.fold)?void 0:C.defaultCollapsed)??!1),E=d({}),O=e=>({...new Map([["input",{allowClear:!0,placeholder:`请输入${e.label}`,maxLength:20}],["input-number",{placeholder:`请输入${e.label}`}],["textarea",{allowClear:!1,placeholder:`请填写${e.label}`,maxLength:200}],["input-tag",{allowClear:!0,placeholder:`请输入${e.label}`}],["mention",{allowClear:!0,placeholder:`请输入${e.label}`}],["select",{allowClear:!0,placeholder:`请选择${e.label}`,options:E[e.field]||e.options}],["tree-select",{allowClear:!0,placeholder:`请选择${e.label}`}],["cascader",{allowClear:!0,placeholder:`请选择${e.label}`,options:E[e.field]||e.options}],["radio-group",{options:E[e.field]||e.options}],["checkbox-group",{options:E[e.field]||e.options}],["date-picker",{allowClear:!0,placeholder:"请选择日期"}],["time-picker",{allowClear:!0,placeholder:"请选择时间"}]]).get(e.type)||{},...e.props}),P=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,R=e=>"boolean"==typeof e.show?e.show:"function"==typeof e.show?e.show($.modelValue):void 0,A=e=>void 0!==e.hide&&("boolean"==typeof e.hide?e.hide:"function"==typeof e.hide?e.hide($.modelValue):void 0),B=e=>void 0!==e.disabled&&("boolean"==typeof e.disabled?e.disabled:"function"==typeof e.disabled?e.disabled($.modelValue):void 0);$.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request($.modelValue).then((l=>{E[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const G=[];$.columns.forEach((e=>{var l;const a=G.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&G.push(e)}));const L=l((()=>s($.modelValue)));return t(L,((e,l)=>{G.forEach((a=>{if(e[a.field]!==l[a.field]){$.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request($.modelValue).then((e=>{E[l.field]=l.resultFormat?l.resultFormat(e):e.data,E[l.field].map((e=>e.value)).includes($.modelValue[l.field])||q("update:modelValue",Object.assign($.modelValue,{[l.field]:""}))})):l.request&&!e[a.field]&&(E[l.field]=[],q("update:modelValue",Object.assign($.modelValue,{[l.field]:""})))}))}}))})),V({formRef:F}),(e,l)=>{const a=r("a-alert"),o=r("a-form-item"),d=r("a-grid-item"),s=r("icon-search"),t=r("a-button"),V=r("icon-up"),x=r("icon-down"),C=r("a-space"),E=r("a-grid"),G=r("a-form");return i(),n(G,p({ref_key:"formRef",ref:F,"auto-label-width":!0},c(I).form,{model:e.modelValue}),{default:u((()=>[f(E,p({class:"w-full","col-gap":8},c(I).grid,{collapsed:c(j)}),{default:u((()=>{var r,F;return[(i(!0),m(b,null,h(e.columns,(l=>{var s,t;return i(),m(b,{key:l.field},[(void 0!==l.show?R(l):!A(l))?(i(),n(d,p({key:0,ref_for:!0},l.gridItemProps||$.options.gridItem,{span:l.span||(null==(s=l.gridItemProps)?void 0:s.span)||(null==(t=c(I).gridItem)?void 0:t.span)}),{default:u((()=>[f(o,p({ref_for:!0},l.formItemProps,{field:l.field,rules:P(l),disabled:B(l)}),v({label:u((()=>["string"==typeof l.label?(i(),m(b,{key:0},[y(g(l.label),1)],64)):(i(),n(_(l.label),{key:1}))])),default:u((()=>[["group-title"].includes(l.type||"")?k(e.$slots,"group-title",{key:1},(()=>[f(a,p({ref_for:!0},l.props),{default:u((()=>[y(g(l.label),1)])),_:2},1040)]),!0):k(e.$slots,l.field,p({key:0,ref_for:!0},{disabled:B(l)}),(()=>[(i(),n(_(`a-${l.type}`),p({ref_for:!0},O(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void q("update:modelValue",Object.assign($.modelValue,{[o]:a}));var a,o}}),v({_:2},[h(null==l?void 0:l.slots,((e,l)=>({name:l,fn:u((l=>["string"==typeof e?(i(),m(b,{key:0},[y(g(e),1)],64)):e?(i(),n(_(e(l)),{key:1})):w("",!0)]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},[h(null==l?void 0:l.formItemSlots,((e,l)=>({name:l,fn:u((()=>["string"==typeof e?(i(),m(b,{key:0},[y(g(e),1)],64)):(i(),n(_(e),{key:1}))]))})))]),1040,["field","rules","disabled"])])),_:2},1040,["span"])):w("",!0)],64)})),128)),(null==(r=c(I).btns)?void 0:r.hide)?w("",!0):(i(),n(d,{key:0,suffix:null==(F=c(I).fold)?void 0:F.enable},{default:u((()=>[f(C,{wrap:""},{default:u((()=>[k(e.$slots,"suffix",{},(()=>{var e;return[f(t,{type:"primary",onClick:l[0]||(l[0]=e=>q("search"))},{icon:u((()=>[f(s)])),default:u((()=>{var e;return[y(g((null==(e=c(I).btns)?void 0:e.searchBtnText)||"搜索"),1)]})),_:1}),f(t,{onClick:l[1]||(l[1]=e=>q("reset"))},{default:u((()=>l[3]||(l[3]=[y("重置")]))),_:1}),(null==(e=c(I).fold)?void 0:e.enable)?(i(),n(t,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=e=>j.value=!c(j))},{icon:u((()=>[c(j)?(i(),n(x,{key:1})):(i(),n(V,{key:0}))])),default:u((()=>[y(g(c(j)?"展开":"收起"),1)])),_:1})):w("",!0)]}),!0)])),_:3})])),_:3},8,["suffix"]))]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-3ca627dc"]]);export{x as _};
