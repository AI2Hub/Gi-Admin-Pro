import{d as e,J as l,b as o,S as a,k as t,ac as s,O as d,e as r,o as i,c as n,w as u,h as p,m as f,f as c,F as m,j as v,B as b,E as y,r as h,G as _,t as V,ao as k,a as w,g}from"./index-CIiNXClJ.js";const x=e({__name:"GiForm",props:{modelValue:{},options:{},columns:{}},emits:["update:modelValue","search","reset"],setup(e,{expose:x,emit:C}){var $;const q=e,F=C,j=l("formRef"),E=o((null==($=q.options.fold)?void 0:$.defaultCollapsed)??!1),O=a({}),B=e=>{var l,o;return e<=((null==(l=q.options.fold)?void 0:l.index)||0)||e>=((null==(o=q.options.fold)?void 0:o.index)||0)&&!E.value},R=e=>{const l={};return"input"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.maxLength=20),"input-number"===e.type&&(l.placeholder=`请输入${e.label}`),"textarea"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.maxLength=200),"select"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.options=O[e.field]||e.options),"cascader"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.options=O[e.field]||e.options),"tree-select"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.data=O[e.field]||e.data),"radio-group"===e.type&&(l.options=O[e.field]||e.options),"checkbox-group"===e.type&&(l.options=O[e.field]||e.options),"date-picker"===e.type&&(l.placeholder="请选择日期"),"time-picker"===e.type&&(l.allowClear=!0,l.placeholder="请选择时间"),{...l,...e.props}},G=e=>void 0!==e&&("boolean"==typeof e?e:"function"==typeof e?e(q.modelValue):void 0);x({formRef:j}),q.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request(q.modelValue).then((l=>{O[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const L=[];q.columns.forEach((e=>{var l;const o=L.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!o.includes(e.field)&&L.push(e)}));const U=t((()=>s(q.modelValue)));return d(U,((e,l)=>{L.forEach((o=>{if(e[o.field]!==l[o.field]){q.columns.filter((e=>{var l;return null==(l=null==o?void 0:o.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[o.field])?l.request(q.modelValue).then((e=>{O[l.field]=l.resultFormat?l.resultFormat(e):e.data,O[l.field].map((e=>e.value)).includes(q.modelValue[l.field])||F("update:modelValue",Object.assign(q.modelValue,{[l.field]:""}))})):l.request&&!e[o.field]&&(O[l.field]=[],F("update:modelValue",Object.assign(q.modelValue,{[l.field]:""})))}))}}))})),(e,l)=>{const o=r("a-alert"),a=r("a-form-item"),t=r("a-col"),s=r("icon-search"),d=r("a-button"),x=r("icon-up"),C=r("icon-down"),$=r("a-space"),O=r("a-row"),L=r("a-form");return i(),n(L,f({ref_key:"formRef",ref:j,"auto-label-width":!0},e.options.form,{model:e.modelValue}),{default:u((()=>[p(O,f({gutter:14},e.options.row,{class:"w-full"}),{default:u((()=>{var r,j,O;return[(i(!0),c(m,null,v(e.columns,((l,s)=>{return i(),c(m,{key:l.field},[(d=l.hide,void 0!==d&&("boolean"==typeof d?d:"function"==typeof d?d(q.modelValue):void 0)?w("",!0):b((i(),n(t,f({key:0,span:l.span||12,ref_for:!0},l.col||l.span?l.col:e.options.col),{default:u((()=>[p(a,f({ref_for:!0},l.item,{label:l.label,field:l.field,rules:l.rules,disabled:G(l.disabled)}),{default:u((()=>[["group-title"].includes(l.type||"")?y(e.$slots,"group-title",{key:1},(()=>[p(o,f({ref_for:!0},l.props),{default:u((()=>[_(V(l.label),1)])),_:2},1040)])):y(e.$slots,l.field,f({key:0,ref_for:!0},{disabled:G(l.disabled)}),(()=>[(i(),n(h(`a-${l.type}`),f({ref_for:!0},R(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return o=e,a=l.field,void F("update:modelValue",Object.assign(q.modelValue,{[a]:o}));var o,a}}),null,16,["model-value","onUpdate:modelValue"]))]))])),_:2},1040,["label","field","rules","disabled"])])),_:2},1040,["span"])),[[k,B(s)]]))],64);var d})),128)),(null==(r=e.options.btns)?void 0:r.hide)?w("",!0):(i(),n(t,f({key:0,span:(null==(j=e.options.btns)?void 0:j.span)||12},null==(O=e.options.btns)?void 0:O.col),{default:u((()=>[p($,{wrap:""},{default:u((()=>[y(e.$slots,"suffix",{},(()=>{var o;return[p(d,{type:"primary",onClick:l[0]||(l[0]=e=>F("search"))},{icon:u((()=>[p(s)])),default:u((()=>{var l;return[_(V((null==(l=e.options.btns)?void 0:l.searchBtnText)||"搜索"),1)]})),_:1}),p(d,{onClick:l[1]||(l[1]=e=>F("reset"))},{default:u((()=>l[3]||(l[3]=[_("重置")]))),_:1}),(null==(o=e.options.fold)?void 0:o.enable)?(i(),n(d,{key:0,type:"text",size:"mini",onClick:l[2]||(l[2]=e=>E.value=!g(E))},{icon:u((()=>[g(E)?(i(),n(C,{key:1})):(i(),n(x,{key:0}))])),default:u((()=>[_(V(g(E)?"展开":"收起"),1)])),_:1})):w("",!0)]}))])),_:3})])),_:3},16,["span"]))]})),_:3},16)])),_:3},16,["model"])}}});export{x as _};
