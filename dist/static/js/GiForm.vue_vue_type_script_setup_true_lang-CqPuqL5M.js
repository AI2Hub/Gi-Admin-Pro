import{d as e,b as l,U as a,k as o,ad as t,P as d,e as s,o as i,c as n,w as r,h as u,m as p,f,F as c,j as m,D as v,H as b,f7 as h,f8 as y,r as V,ap as k,a as w,I as _,t as x,g}from"./index-B2dmbZHS.js";const C=e({__name:"GiForm",props:{modelValue:{},options:{},columns:{}},emits:["update:modelValue","search","reset"],setup(e,{expose:C,emit:$}){var q;const F=e,j=$,E=l(),O=l((null==(q=F.options.fold)?void 0:q.defaultCollapsed)??!1),U=a({}),B=e=>{var l,a;return e<=((null==(l=F.options.fold)?void 0:l.index)||0)||e>=((null==(a=F.options.fold)?void 0:a.index)||0)&&!O.value},L=e=>{const l={};return"input"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.maxLength=20),"input-number"===e.type&&(l.placeholder=`请输入${e.label}`),"textarea"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.maxLength=200),"select"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.options=U[e.field]||e.options),"cascader"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.options=U[e.field]||e.options),"tree-select"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.data=U[e.field]||e.data),"radio-group"===e.type&&(l.options=U[e.field]||e.options),"checkbox-group"===e.type&&(l.options=U[e.field]||e.options),"date-picker"===e.type&&(l.placeholder="请选择日期"),"time-picker"===e.type&&(l.allowClear=!0,l.placeholder="请选择时间"),{...l,...e.props}},R=e=>void 0!==e&&("boolean"==typeof e?e:"function"==typeof e?e(F.modelValue):void 0);C({formRef:E}),F.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request(F.modelValue).then((l=>{U[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const z=[];F.columns.forEach((e=>{var l;const a=z.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&z.push(e)}));const D=o((()=>t(F.modelValue)));return d(D,((e,l)=>{z.forEach((a=>{if(e[a.field]!==l[a.field]){F.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request(F.modelValue).then((e=>{U[l.field]=l.resultFormat?l.resultFormat(e):e.data,U[l.field].map((e=>e.value)).includes(F.modelValue[l.field])||j("update:modelValue",Object.assign(F.modelValue,{[l.field]:""}))})):l.request&&!e[a.field]&&(U[l.field]=[],j("update:modelValue",Object.assign(F.modelValue,{[l.field]:""})))}))}}))})),(e,l)=>{const a=s("a-form-item"),o=s("a-col"),t=s("icon-search"),d=s("a-button"),C=s("icon-up"),$=s("icon-down"),q=s("a-space"),U=s("a-row"),z=s("a-form");return i(),n(z,p({ref_key:"formRef",ref:E,"auto-label-width":!0},e.options.form,{model:e.modelValue}),{default:r((()=>[u(U,p({gutter:14},e.options.row,{class:"w-full"}),{default:r((()=>{var s,E,U;return[(i(!0),f(c,null,m(e.columns,((l,t)=>{return i(),f(c,{key:l.field},[(d=l.hide,void 0!==d&&("boolean"==typeof d?d:"function"==typeof d?d(F.modelValue):void 0)?w("",!0):v((i(),n(o,p({key:0,span:l.span||12},l.col||l.span?l.col:e.options.col),{default:r((()=>[u(a,p(l.item,{label:l.label,field:l.field,rules:l.rules,disabled:R(l.disabled)}),{default:r((()=>[b(e.$slots,l.field,h(y({disabled:R(l.disabled)})),(()=>[(i(),n(V(`a-${l.type}`),p(L(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void j("update:modelValue",Object.assign(F.modelValue,{[o]:a}));var a,o}}),null,16,["model-value","onUpdate:modelValue"]))]))])),_:2},1040,["label","field","rules","disabled"])])),_:2},1040,["span"])),[[k,B(t)]]))],64);var d})),128)),(null==(s=e.options.btns)?void 0:s.hide)?w("",!0):(i(),n(o,p({key:0,span:(null==(E=e.options.btns)?void 0:E.span)||12},null==(U=e.options.btns)?void 0:U.col),{default:r((()=>[u(q,{wrap:""},{default:r((()=>[b(e.$slots,"suffix",{},(()=>{var a;return[u(d,{type:"primary",onClick:l[0]||(l[0]=e=>j("search"))},{icon:r((()=>[u(t)])),default:r((()=>{var l;return[_(x((null==(l=e.options.btns)?void 0:l.searchBtnText)||"搜索"),1)]})),_:1}),u(d,{onClick:l[1]||(l[1]=e=>j("reset"))},{default:r((()=>[_("重置")])),_:1}),(null==(a=e.options.fold)?void 0:a.enable)?(i(),n(d,{key:0,type:"text",size:"mini",onClick:l[2]||(l[2]=e=>O.value=!g(O))},{icon:r((()=>[g(O)?(i(),n($,{key:1})):(i(),n(C,{key:0}))])),default:r((()=>[_(x(g(O)?"展开":"收起"),1)])),_:1})):w("",!0)]}))])),_:3})])),_:3},16,["span"]))]})),_:3},16)])),_:3},16,["model"])}}});export{C as _};
