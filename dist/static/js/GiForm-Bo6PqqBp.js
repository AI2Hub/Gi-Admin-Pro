import{d as e,k as l,J as a,b as o,S as t,ae as d,O as s,e as r,o as i,c as n,w as u,h as f,m as p,g as c,f as m,F as y,j as v,f8 as b,G as g,t as _,r as h,E as k,a as V,_ as x}from"./index-CpyorRoN.js";const w=x(e({__name:"GiForm",props:{modelValue:{},options:{default:()=>({})},columns:{}},emits:["update:modelValue","search","reset"],setup(e,{expose:x,emit:w}){var C;const I=e,$=w,q=l((()=>({grid:{cols:2},gridItem:{span:{xs:2,sm:1}},...I.options}))),F=a("formRef"),j=o((null==(C=I.options.fold)?void 0:C.defaultCollapsed)??!1),E=t({}),O=e=>{const l={};return e.type&&["input","input-number","input-tag","mention"].includes(e.type)&&(l.placeholder=`请输入${e.label}`),e.type&&["textarea"].includes(e.type)&&(l.placeholder=`请填写${e.label}`),e.type&&["select","tree-select","cascader"].includes(e.type)&&(l.placeholder=`请选择${e.label}`),"input"===e.type&&(l.allowClear=!0,l.maxLength=20),"textarea"===e.type&&(l.allowClear=!0,l.maxLength=200),"select"===e.type&&(l.allowClear=!0,l.options=E[e.field]||e.options),"cascader"===e.type&&(l.allowClear=!0,l.options=E[e.field]||e.options),"tree-select"===e.type&&(l.allowClear=!0,l.data=E[e.field]||e.data),"radio-group"===e.type&&(l.options=E[e.field]||e.options),"checkbox-group"===e.type&&(l.options=E[e.field]||e.options),"date-picker"===e.type&&(l.placeholder="请选择日期"),"time-picker"===e.type&&(l.allowClear=!0,l.placeholder="请选择时间"),{...l,...e.props}},P=e=>void 0!==e&&("boolean"==typeof e?e:"function"==typeof e?e(I.modelValue):void 0);I.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request(I.modelValue).then((l=>{E[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const R=[];I.columns.forEach((e=>{var l;const a=R.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&R.push(e)}));const B=l((()=>d(I.modelValue)));return s(B,((e,l)=>{R.forEach((a=>{if(e[a.field]!==l[a.field]){I.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request(I.modelValue).then((e=>{E[l.field]=l.resultFormat?l.resultFormat(e):e.data,E[l.field].map((e=>e.value)).includes(I.modelValue[l.field])||$("update:modelValue",Object.assign(I.modelValue,{[l.field]:""}))})):l.request&&!e[a.field]&&(E[l.field]=[],$("update:modelValue",Object.assign(I.modelValue,{[l.field]:""})))}))}}))})),x({formRef:F}),(e,l)=>{const a=r("a-alert"),o=r("a-form-item"),t=r("a-grid-item"),d=r("icon-search"),s=r("a-button"),x=r("icon-up"),w=r("icon-down"),C=r("a-space"),E=r("a-grid"),R=r("a-form");return i(),n(R,p({ref_key:"formRef",ref:F,"auto-label-width":!0},c(q).form,{model:e.modelValue}),{default:u((()=>[f(E,p({class:"w-full","col-gap":8},c(q).grid,{collapsed:c(j)}),{default:u((()=>{var r,F;return[(i(!0),m(y,null,v(e.columns,(l=>{var d,s,r;return i(),m(y,{key:l.field},[(r=l.hide,void 0!==r&&("boolean"==typeof r?r:"function"==typeof r?r(I.modelValue):void 0)?V("",!0):(i(),n(t,p({key:0,ref_for:!0},l.gridItemProps||I.options.gridItem,{span:l.span||(null==(d=l.gridItemProps)?void 0:d.span)||(null==(s=c(q).gridItem)?void 0:s.span)}),{default:u((()=>[f(o,p({ref_for:!0},l.formItemProps,{field:l.field,rules:l.rules,disabled:P(l.disabled)}),b({label:u((()=>["string"==typeof l.label?(i(),m(y,{key:0},[g(_(l.label),1)],64)):(i(),n(h(l.label),{key:1}))])),default:u((()=>[["group-title"].includes(l.type||"")?k(e.$slots,"group-title",{key:1},(()=>[f(a,p({ref_for:!0},l.props),{default:u((()=>[g(_(l.label),1)])),_:2},1040)]),!0):k(e.$slots,l.field,p({key:0,ref_for:!0},{disabled:P(l.disabled)}),(()=>[(i(),n(h(`a-${l.type}`),p({ref_for:!0},O(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void $("update:modelValue",Object.assign(I.modelValue,{[o]:a}));var a,o}}),b({_:2},[v(null==l?void 0:l.slots,((e,l)=>({name:l,fn:u((l=>["string"==typeof e?(i(),m(y,{key:0},[g(_(e),1)],64)):e?(i(),n(h(e(l)),{key:1})):V("",!0)]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},[v(null==l?void 0:l.formItemSlots,((e,l)=>({name:l,fn:u((()=>["string"==typeof e?(i(),m(y,{key:0},[g(_(e),1)],64)):(i(),n(h(e),{key:1}))]))})))]),1040,["field","rules","disabled"])])),_:2},1040,["span"])))],64)})),128)),(null==(r=c(q).btns)?void 0:r.hide)?V("",!0):(i(),n(t,{key:0,suffix:null==(F=c(q).fold)?void 0:F.enable},{default:u((()=>[f(C,{wrap:""},{default:u((()=>[k(e.$slots,"suffix",{},(()=>{var e;return[f(s,{type:"primary",onClick:l[0]||(l[0]=e=>$("search"))},{icon:u((()=>[f(d)])),default:u((()=>{var e;return[g(_((null==(e=c(q).btns)?void 0:e.searchBtnText)||"搜索"),1)]})),_:1}),f(s,{onClick:l[1]||(l[1]=e=>$("reset"))},{default:u((()=>l[3]||(l[3]=[g("重置")]))),_:1}),(null==(e=c(q).fold)?void 0:e.enable)?(i(),n(s,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=e=>j.value=!c(j))},{icon:u((()=>[c(j)?(i(),n(w,{key:1})):(i(),n(x,{key:0}))])),default:u((()=>[g(_(c(j)?"展开":"收起"),1)])),_:1})):V("",!0)]}),!0)])),_:3})])),_:3},8,["suffix"]))]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-7e77d104"]]);export{w as _};
