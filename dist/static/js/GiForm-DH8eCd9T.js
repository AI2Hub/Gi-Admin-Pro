import{d as e,k as l,J as a,b as o,U as t,af as d,P as s,e as r,o as i,c as n,w as u,h as f,m as p,g as c,f as m,F as b,j as v,f9 as h,G as y,t as g,r as _,E as k,a as V,_ as w}from"./index-CrLPKOLl.js";const x=w(e({__name:"GiForm",props:{modelValue:{},options:{default:()=>({})},columns:{}},emits:["update:modelValue","search","reset"],setup(e,{expose:w,emit:x}){var C;const $=e,I=x,q=l((()=>({grid:{cols:2},gridItem:{span:{xs:2,sm:1}},...$.options}))),F=a("formRef"),j=o((null==(C=$.options.fold)?void 0:C.defaultCollapsed)??!1),E=t({}),P=e=>({...new Map([["input",{allowClear:!0,placeholder:`请输入${e.label}`,maxLength:20}],["input-number",{placeholder:`请输入${e.label}`}],["textarea",{allowClear:!1,placeholder:`请填写${e.label}`,maxLength:200}],["input-tag",{allowClear:!0,placeholder:`请输入${e.label}`}],["mention",{allowClear:!0,placeholder:`请输入${e.label}`}],["select",{allowClear:!0,placeholder:`请选择${e.label}`,options:E[e.field]||e.options}],["tree-select",{allowClear:!0,placeholder:`请选择${e.label}`}],["cascader",{allowClear:!0,placeholder:`请选择${e.label}`,options:E[e.field]||e.options}],["radio-group",{options:E[e.field]||e.options}],["checkbox-group",{options:E[e.field]||e.options}],["date-picker",{allowClear:!0,placeholder:"请选择日期"}],["time-picker",{allowClear:!0,placeholder:"请选择时间"}]]).get(e.type)||{},...e.props}),O=e=>void 0!==e&&("boolean"==typeof e?e:"function"==typeof e?e($.modelValue):void 0);$.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request($.modelValue).then((l=>{E[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const R=[];$.columns.forEach((e=>{var l;const a=R.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&R.push(e)}));const U=l((()=>d($.modelValue)));return s(U,((e,l)=>{R.forEach((a=>{if(e[a.field]!==l[a.field]){$.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request($.modelValue).then((e=>{E[l.field]=l.resultFormat?l.resultFormat(e):e.data,E[l.field].map((e=>e.value)).includes($.modelValue[l.field])||I("update:modelValue",Object.assign($.modelValue,{[l.field]:""}))})):l.request&&!e[a.field]&&(E[l.field]=[],I("update:modelValue",Object.assign($.modelValue,{[l.field]:""})))}))}}))})),w({formRef:F}),(e,l)=>{const a=r("a-alert"),o=r("a-form-item"),t=r("a-grid-item"),d=r("icon-search"),s=r("a-button"),w=r("icon-up"),x=r("icon-down"),C=r("a-space"),E=r("a-grid"),R=r("a-form");return i(),n(R,p({ref_key:"formRef",ref:F,"auto-label-width":!0},c(q).form,{model:e.modelValue}),{default:u((()=>[f(E,p({class:"w-full","col-gap":8},c(q).grid,{collapsed:c(j)}),{default:u((()=>{var r,F;return[(i(!0),m(b,null,v(e.columns,(l=>{var d,s,r;return i(),m(b,{key:l.field},[(r=l.hide,void 0!==r&&("boolean"==typeof r?r:"function"==typeof r?r($.modelValue):void 0)?V("",!0):(i(),n(t,p({key:0,ref_for:!0},l.gridItemProps||$.options.gridItem,{span:l.span||(null==(d=l.gridItemProps)?void 0:d.span)||(null==(s=c(q).gridItem)?void 0:s.span)}),{default:u((()=>[f(o,p({ref_for:!0},l.formItemProps,{field:l.field,rules:l.rules,disabled:O(l.disabled)}),h({label:u((()=>["string"==typeof l.label?(i(),m(b,{key:0},[y(g(l.label),1)],64)):(i(),n(_(l.label),{key:1}))])),default:u((()=>[["group-title"].includes(l.type||"")?k(e.$slots,"group-title",{key:1},(()=>[f(a,p({ref_for:!0},l.props),{default:u((()=>[y(g(l.label),1)])),_:2},1040)]),!0):k(e.$slots,l.field,p({key:0,ref_for:!0},{disabled:O(l.disabled)}),(()=>[(i(),n(_(`a-${l.type}`),p({ref_for:!0},P(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void I("update:modelValue",Object.assign($.modelValue,{[o]:a}));var a,o}}),h({_:2},[v(null==l?void 0:l.slots,((e,l)=>({name:l,fn:u((l=>["string"==typeof e?(i(),m(b,{key:0},[y(g(e),1)],64)):e?(i(),n(_(e(l)),{key:1})):V("",!0)]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},[v(null==l?void 0:l.formItemSlots,((e,l)=>({name:l,fn:u((()=>["string"==typeof e?(i(),m(b,{key:0},[y(g(e),1)],64)):(i(),n(_(e),{key:1}))]))})))]),1040,["field","rules","disabled"])])),_:2},1040,["span"])))],64)})),128)),(null==(r=c(q).btns)?void 0:r.hide)?V("",!0):(i(),n(t,{key:0,suffix:null==(F=c(q).fold)?void 0:F.enable},{default:u((()=>[f(C,{wrap:""},{default:u((()=>[k(e.$slots,"suffix",{},(()=>{var e;return[f(s,{type:"primary",onClick:l[0]||(l[0]=e=>I("search"))},{icon:u((()=>[f(d)])),default:u((()=>{var e;return[y(g((null==(e=c(q).btns)?void 0:e.searchBtnText)||"搜索"),1)]})),_:1}),f(s,{onClick:l[1]||(l[1]=e=>I("reset"))},{default:u((()=>l[3]||(l[3]=[y("重置")]))),_:1}),(null==(e=c(q).fold)?void 0:e.enable)?(i(),n(s,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=e=>j.value=!c(j))},{icon:u((()=>[c(j)?(i(),n(x,{key:1})):(i(),n(w,{key:0}))])),default:u((()=>[y(g(c(j)?"展开":"收起"),1)])),_:1})):V("",!0)]}),!0)])),_:3})])),_:3},8,["suffix"]))]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-a95f944f"]]);export{x as _};
