import{E as e,a as l}from"./regexp-LyZ7ySAN.js";import{b as a,d,k as t,J as s,e as o,o as i,c as u,w as m,h as r,g as n,fb as c,fc as f,G as p,H as h,U as b}from"./index-B3chAJQx.js";import{g}from"./user-BSwRaDSx.js";import{s as v}from"./index-C4aoj-e3.js";import{u as V}from"./useDept-CeXX00YX.js";import{b as _}from"./role-Dk04k-MH.js";import{u as x}from"./useForm-CGIU6xq4.js";const w=d({__name:"AddUserModal",emits:["save-success"],setup(d,{expose:w,emit:k}){const y=k,{roleList:U,getRoleList:I}=function(){const e=a(!1),l=a([]),d=a(0);return{roleList:l,getRoleList:async()=>{try{e.value=!0;const a=await _({page:1,size:99});l.value=a.data.records.filter((e=>1===e.status)),d.value=a.data.total}finally{e.value=!1}},loading:e,total:d}}();I();const j=t((()=>U.value.map((e=>({label:e.name,value:e.code}))))),{deptList:L,getDeptList:M}=V();M();const q={xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},R=s("formRef"),z=a(""),F=t((()=>!!z.value)),B=t((()=>F.value?"编辑用户":"新增用户")),D=a(!1),{form:E,resetForm:H}=x({id:"",username:"",nickname:"",gender:1,phone:"",email:"",deptId:"",roleIds:[],description:"",status:1,type:2,disabled:!1}),O={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:e,message:"邮箱格式不正确"}],phone:[{match:l,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],roleIds:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]},A=()=>{var e;null==(e=R.value)||e.resetFields(),H()};w({add:()=>{z.value="",D.value=!0},edit:async e=>{D.value=!0,z.value=e;const l=await g({id:e});Object.assign(E,l.data)}});const C=async()=>{var e;try{if(await(null==(e=R.value)?void 0:e.validate()))return!1;return!!(await v(E)).data&&(b.success("模拟保存成功"),y("save-success"),!0)}catch(l){return!1}};return(e,l)=>{const a=o("a-input"),d=o("a-form-item"),t=o("a-col"),s=o("a-row"),b=o("a-radio"),g=o("a-radio-group"),v=o("a-tree-select"),V=o("a-select"),_=o("a-textarea"),x=o("a-switch"),w=o("a-form"),k=o("a-modal");return i(),u(k,{visible:n(D),"onUpdate:visible":l[9]||(l[9]=e=>h(D)?D.value=e:null),title:n(B),width:"90%","mask-closable":!1,"modal-style":{maxWidth:"600px"},"body-style":{maxHeight:"70vh"},onBeforeOk:C,onClose:A},{default:m((()=>[r(w,{ref_key:"formRef",ref:R,model:n(E),rules:O,size:"medium","auto-label-width":""},{default:m((()=>[r(s,null,{default:m((()=>[r(t,c(f(q)),{default:m((()=>[r(d,{label:"用户名",field:"username"},{default:m((()=>[r(a,{modelValue:n(E).username,"onUpdate:modelValue":l[0]||(l[0]=e=>n(E).username=e),modelModifiers:{trim:!0},placeholder:"请输入用户名","allow-clear":"",disabled:n(E).disabled,"max-length":10},null,8,["modelValue","disabled"])])),_:1})])),_:1},16),r(t,c(f(q)),{default:m((()=>[r(d,{label:"昵称",field:"nickname"},{default:m((()=>[r(a,{modelValue:n(E).nickname,"onUpdate:modelValue":l[1]||(l[1]=e=>n(E).nickname=e),modelModifiers:{trim:!0},placeholder:"请输入昵称","allow-clear":"","max-length":10},null,8,["modelValue"])])),_:1})])),_:1},16),r(t,c(f(q)),{default:m((()=>[r(d,{label:"手机号码",field:"phone"},{default:m((()=>[r(a,{modelValue:n(E).phone,"onUpdate:modelValue":l[2]||(l[2]=e=>n(E).phone=e),modelModifiers:{trim:!0},placeholder:"请输入手机号码","allow-clear":"","max-length":11},null,8,["modelValue"])])),_:1})])),_:1},16),r(t,c(f(q)),{default:m((()=>[r(d,{label:"邮箱",field:"email"},{default:m((()=>[r(a,{modelValue:n(E).email,"onUpdate:modelValue":l[3]||(l[3]=e=>n(E).email=e),modelModifiers:{trim:!0},placeholder:"请输入邮箱","allow-clear":"","max-length":30},null,8,["modelValue"])])),_:1})])),_:1},16)])),_:1}),r(d,{label:"性别",field:"gender"},{default:m((()=>[r(g,{modelValue:n(E).gender,"onUpdate:modelValue":l[4]||(l[4]=e=>n(E).gender=e)},{default:m((()=>[r(b,{value:1},{default:m((()=>l[10]||(l[10]=[p("男")]))),_:1}),r(b,{value:2},{default:m((()=>l[11]||(l[11]=[p("女")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),r(d,{label:"所属部门",field:"deptId"},{default:m((()=>[r(v,{modelValue:n(E).deptId,"onUpdate:modelValue":l[5]||(l[5]=e=>n(E).deptId=e),data:n(L),"field-names":{key:"id",title:"name"},placeholder:"请选择所属部门","allow-clear":"","allow-search":"",disabled:n(E).disabled},null,8,["modelValue","data","disabled"])])),_:1}),r(d,{label:"角色",field:"roleIds",disabled:n(E).disabled},{default:m((()=>[r(V,{modelValue:n(E).roleIds,"onUpdate:modelValue":l[6]||(l[6]=e=>n(E).roleIds=e),options:n(j),placeholder:"请选择所属角色",multiple:"","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])])),_:1},8,["disabled"]),r(d,{label:"描述",field:"description"},{default:m((()=>[r(_,{modelValue:n(E).description,"onUpdate:modelValue":l[7]||(l[7]=e=>n(E).description=e),modelModifiers:{trim:!0},"max-length":200,placeholder:"请填写描述","auto-size":{minRows:3},"show-word-limit":""},null,8,["modelValue"])])),_:1}),r(d,{label:"状态",field:"status"},{default:m((()=>[r(x,{modelValue:n(E).status,"onUpdate:modelValue":l[8]||(l[8]=e=>n(E).status=e),type:"round","checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])}}});export{w as _};
