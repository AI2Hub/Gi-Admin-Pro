import{U as e,P as a,$ as t,b as n,M as s,V as l,k as o}from"./index-CrLPKOLl.js";import{d as i}from"./index-Cy6LVXj5.js";function r(n,s={defaultPageSize:10}){const{breakpoint:l}=function(){const e=i({xs:576,sm:576,md:768,lg:992,xl:1200,xxl:1600}).current(),a=o((()=>e.value[e.value.length-1]||"xs"));return{breakpoint:a}}(),r=e({showPageSize:!0,showTotal:!0,current:1,pageSize:s.defaultPageSize,total:0,simple:!1,onChange:e=>{r.current=e,n&&n()},onPageSizeChange:e=>{r.current=1,r.pageSize=e,n&&n()}});a((()=>l.value),(()=>{r.simple=["xs"].includes(l.value),r.showTotal=!["xs"].includes(l.value)}),{immediate:!0});const c=r.onChange,u=r.onPageSizeChange;const{current:d,pageSize:g,total:h}=t(r);return{current:d,pageSize:g,total:h,pagination:r,changeCurrent:c,changePageSize:u,setTotal:function(e){r.total=e}}}function c(e,a){const{formatResult:t,onSuccess:o,immediate:i,rowKey:c}=a||{},{pagination:u,setTotal:d}=r((()=>p())),g=n(!1),h=n([]);async function p(){try{g.value=!0;const a=await e({page:u.current,size:u.pageSize}),n=Array.isArray(a.data)?a.data:a.data.records;h.value=t?t(n):n;const s=Array.isArray(a.data)?n.length:a.data.total;d(s),o&&o()}finally{g.value=!1}}(i??!0)&&p();const v=n([]);return{loading:g,tableData:h,getTableData:p,search:()=>{v.value=[],u.onChange(1)},pagination:u,selectedKeys:v,select:e=>{v.value=e},selectAll:e=>{const a=c??"id",t=h.value.filter((e=>!(null==e?void 0:e.disabled)));v.value=e?t.map((e=>e[a])):[]},handleDelete:async(e,a)=>{const t=async()=>{try{const t=await e();return t.success&&(l.success((null==a?void 0:a.successTip)||"删除成功！"),v.value=[],p()),t.success}catch(t){return!1}};if(!((null==a?void 0:a.showModal)??!0))return t();s.warning({title:(null==a?void 0:a.title)||"提示",content:(null==a?void 0:a.content)||"是否确认删除？",hideCancel:!1,maskClosable:!1,onBeforeOk:t})},refresh:()=>{p()}}}export{c as u};
