import{S as e,O as a,$ as t,b as n,k as s,M as i,V as l}from"./index-raaeN5sp.js";import{u as o}from"./useBreakpoint-ujt6TRdE.js";function r(r,c){const{formatResult:u,onSuccess:d,immediate:g,rowKey:p}=c||{},{pagination:h,setTotal:v}=function(n,s={defaultPageSize:10}){const{breakpoint:i}=o(),l=e({showPageSize:!0,showTotal:!0,current:1,pageSize:s.defaultPageSize,total:0,simple:!1,onChange:e=>{l.current=e,n&&n()},onPageSizeChange:e=>{l.current=1,l.pageSize=e,n&&n()}});a((()=>i.value),(()=>{l.simple=["xs"].includes(i.value),l.showTotal=!["xs"].includes(i.value)}),{immediate:!0});const r=l.onChange,c=l.onPageSizeChange,{current:u,pageSize:d,total:g}=t(l);return{current:u,pageSize:d,total:g,pagination:l,changeCurrent:r,changePageSize:c,setTotal:function(e){l.total=e}}}((()=>S())),f=n(!1),m=n([]);async function S(){try{f.value=!0;const e=await r({page:h.current,size:h.pageSize}),a=Array.isArray(e.data)?e.data:e.data.records;m.value=u?u(a):a;const t=Array.isArray(e.data)?a.length:e.data.total;v(t),d&&d()}finally{f.value=!1}}(g??!0)&&S();const y=n([]),{breakpoint:z}=o(),w=s((()=>["xs","sm"].includes(z.value)?void 0:"right"));return{loading:f,tableData:m,getTableData:S,search:()=>{y.value=[],h.onChange(1)},pagination:h,selectedKeys:y,select:e=>{y.value=e},selectAll:e=>{const a=p??"id",t=m.value.filter((e=>!(null==e?void 0:e.disabled)));y.value=e?t.map((e=>e[a])):[]},handleDelete:async(e,a)=>{const t=async()=>{try{const t=await e();return t.success&&(l.success((null==a?void 0:a.successTip)||"删除成功！"),y.value=[],S()),t.success}catch(t){return!1}};if(!((null==a?void 0:a.showModal)??!0))return t();i.warning({title:(null==a?void 0:a.title)||"提示",content:(null==a?void 0:a.content)||"是否确认删除？",hideCancel:!1,maskClosable:!1,onBeforeOk:t})},refresh:()=>{S()},fixed:w}}export{r as u};
