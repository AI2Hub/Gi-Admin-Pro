import{_ as e}from"./index-Cw66a2pZ.js";import{O as a,a as t}from"./regexp-LyZ7ySAN.js";import{a2 as r,a3 as n,a4 as o,a5 as s,a6 as i,a7 as l,a8 as u,a9 as c,aa as d,ab as f,ac as m,l as p,n as v,U as g,k as h,b,P as _,V as y,M as j,ad as k,d as w,e as x,o as A,f as O,i as E,h as R,w as C,g as L,I as q,t as P,_ as F}from"./index-D01VDiOw.js";import{i as S,g as V,a as I,u as z}from"./index-kO2mkmhq.js";function D(e){var a=-1,t=null==e?0:e.length;for(this.__data__=new r;++a<t;)this.add(e[a])}function T(e,a){for(var t=-1,r=null==e?0:e.length;++t<r;)if(a(e[t],t,e))return!0;return!1}D.prototype.add=D.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},D.prototype.has=function(e){return this.__data__.has(e)};var B=1,U=2;function M(e,a,t,r,n,o){var s=t&B,i=e.length,l=a.length;if(i!=l&&!(s&&l>i))return!1;var u=o.get(e),c=o.get(a);if(u&&c)return u==a&&c==e;var d=-1,f=!0,m=t&U?new D:void 0;for(o.set(e,a),o.set(a,e);++d<i;){var p=e[d],v=a[d];if(r)var g=s?r(v,p,d,a,e,o):r(p,v,d,e,a,o);if(void 0!==g){if(g)continue;f=!1;break}if(m){if(!T(a,(function(e,a){if(s=a,!m.has(s)&&(p===e||n(p,e,t,r,o)))return m.push(a);var s}))){f=!1;break}}else if(p!==v&&!n(p,v,t,r,o)){f=!1;break}}return o.delete(e),o.delete(a),f}function N(e){var a=-1,t=Array(e.size);return e.forEach((function(e,r){t[++a]=[r,e]})),t}function G(e){var a=-1,t=Array(e.size);return e.forEach((function(e){t[++a]=e})),t}var H=1,J=2,K="[object Boolean]",Q="[object Date]",W="[object Error]",X="[object Map]",Y="[object Number]",Z="[object RegExp]",$="[object Set]",ee="[object String]",ae="[object Symbol]",te="[object ArrayBuffer]",re="[object DataView]",ne=n?n.prototype:void 0,oe=ne?ne.valueOf:void 0;var se=1,ie=Object.prototype.hasOwnProperty;var le=1,ue="[object Arguments]",ce="[object Array]",de="[object Object]",fe=Object.prototype.hasOwnProperty;function me(e,a,t,r,n,m){var p=f(e),v=f(a),g=p?ce:l(e),h=v?ce:l(a),b=(g=g==ue?de:g)==de,_=(h=h==ue?de:h)==de,y=g==h;if(y&&u(e)){if(!u(a))return!1;p=!0,b=!1}if(y&&!b)return m||(m=new c),p||d(e)?M(e,a,t,r,n,m):function(e,a,t,r,n,i,l){switch(t){case re:if(e.byteLength!=a.byteLength||e.byteOffset!=a.byteOffset)return!1;e=e.buffer,a=a.buffer;case te:return!(e.byteLength!=a.byteLength||!i(new s(e),new s(a)));case K:case Q:case Y:return o(+e,+a);case W:return e.name==a.name&&e.message==a.message;case Z:case ee:return e==a+"";case X:var u=N;case $:var c=r&H;if(u||(u=G),e.size!=a.size&&!c)return!1;var d=l.get(e);if(d)return d==a;r|=J,l.set(e,a);var f=M(u(e),u(a),r,n,i,l);return l.delete(e),f;case ae:if(oe)return oe.call(e)==oe.call(a)}return!1}(e,a,g,t,r,n,m);if(!(t&le)){var j=b&&fe.call(e,"__wrapped__"),k=_&&fe.call(a,"__wrapped__");if(j||k){var w=j?e.value():e,x=k?a.value():a;return m||(m=new c),n(w,x,t,r,m)}}return!!y&&(m||(m=new c),function(e,a,t,r,n,o){var s=t&se,l=i(e),u=l.length;if(u!=i(a).length&&!s)return!1;for(var c=u;c--;){var d=l[c];if(!(s?d in a:ie.call(a,d)))return!1}var f=o.get(e),m=o.get(a);if(f&&m)return f==a&&m==e;var p=!0;o.set(e,a),o.set(a,e);for(var v=s;++c<u;){var g=e[d=l[c]],h=a[d];if(r)var b=s?r(h,g,d,a,e,o):r(g,h,d,e,a,o);if(!(void 0===b?g===h||n(g,h,t,r,o):b)){p=!1;break}v||(v="constructor"==d)}if(p&&!v){var _=e.constructor,y=a.constructor;_==y||!("constructor"in e)||!("constructor"in a)||"function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y||(p=!1)}return o.delete(e),o.delete(a),p}(e,a,t,r,n,m))}function pe(e,a,t,r,n){return e===a||(null==e||null==a||!m(e)&&!m(a)?e!=e&&a!=a:me(e,a,t,r,pe,n))}function ve(e){const a=p(),t=v(),r=g({}),n=g({}),o=h((()=>!!a.query[(null==e?void 0:e.key)||"id"])),s=b(!1),i=b(!1),l=b(!1),u=h((()=>o.value?"编辑":"新增")),c=async()=>{try{i.value=!0;const a=o.value?await e.detailApi(r):await e.initApi();a.success&&(Object.assign(r,a.data),Object.assign(n,a.data),s.value=!1)}catch(a){e.onError&&e.onError(a)}finally{i.value=!1}};c(),_((()=>a.query),(()=>{c()})),_((()=>r),(e=>{s.value=!pe(e,n)}),{immediate:!0,deep:!0});return{form:r,title:u,loading:i,isEdit:o,back:()=>{s.value?j.warning({title:"提示",content:"您确定丢弃更改的内容吗？",hideCancel:!1,onOk:()=>{t.back()}}):t.back()},save:async()=>{var n,s;try{if(await(null==(s=null==(n=null==e?void 0:e.formRef)?void 0:n.value)?void 0:s.validate()))return;l.value=!0;const i=o.value?await e.editApi(r):await e.addApi(r);i.success&&(y.success(o.value?"编辑成功！":"新增成功！"),o.value||!0!==e.addToEdit||t.replace({path:a.fullPath,query:{[e.key]:i.data[e.key]}}),e.onSuccess&&e.onSuccess(i.data))}catch(i){e.onError&&e.onError(i)}finally{l.value=!1}},saveLoading:l,reset:()=>{var a,t;if(o.value){for(const e in r)delete r[e];Object.assign(r,k(n))}else null==(t=null==(a=null==e?void 0:e.formRef)?void 0:a.value)||t.resetFields()}}}const ge={class:"gi_page form-base"},he={class:"gi_box"},be=F(w({name:"DataForm",__name:"index",setup(r){const n=p(),o=b(),s={name:[{required:!0,message:"请输入姓名"},{maxLength:4,message:"姓名不超过4个字符"},{match:a,message:"仅支持中文姓名"}],phone:[{required:!0,message:"请输入手机号"},{match:t,message:"手机号格式不正确"}]},{form:i,title:l,loading:u,save:c,saveLoading:d,back:f,reset:m}=ve({key:"id",formRef:o,initApi:S,detailApi:()=>V({id:n.query.id}),addApi:e=>I({...e,extra:"额外参数-新增"}),editApi:e=>z({...e,extra:"额外参数-编辑"}),addToEdit:!0,onSuccess:()=>{}});return(a,t)=>{const r=x("a-button"),n=x("a-form-item"),p=x("a-input"),v=x("a-typography-text"),g=x("a-space"),h=x("a-form"),b=e,_=x("a-spin"),y=x("a-card");return A(),O("div",ge,[E("section",he,[R(y,{title:L(l),bordered:!1},{extra:C((()=>[R(r,{onClick:L(f)},{default:C((()=>[q("返回")])),_:1},8,["onClick"])])),default:C((()=>[R(_,{loading:L(u)},{default:C((()=>[R(h,{ref_key:"formRef",ref:o,model:L(i),rules:s,"auto-label-width":"",class:"form-base__form"},{default:C((()=>[R(n,{label:"ID",field:"id"},{default:C((()=>[q(P(L(i).id||"暂无"),1)])),_:1}),R(n,{label:"姓名",field:"name"},{extra:C((()=>[R(v,{type:"secondary"},{default:C((()=>[q("请输入中文姓名")])),_:1})])),default:C((()=>[R(p,{modelValue:L(i).name,"onUpdate:modelValue":t[0]||(t[0]=e=>L(i).name=e),placeholder:"请输入姓名","allow-clear":""},null,8,["modelValue"])])),_:1}),R(n,{label:"手机号",field:"phone"},{default:C((()=>[R(p,{modelValue:L(i).phone,"onUpdate:modelValue":t[1]||(t[1]=e=>L(i).phone=e),placeholder:"请输入手机号","allow-clear":""},null,8,["modelValue"])])),_:1}),R(n,null,{default:C((()=>[R(g,null,{default:C((()=>[R(r,{onClick:L(m)},{default:C((()=>[q("重置")])),_:1},8,["onClick"]),R(r,{type:"primary",loading:L(d),onClick:L(c)},{default:C((()=>[q("提交")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["model"]),R(b,{"code-json":"\nconst route = useRoute()\nconst formRef = ref<FormInstance>()\n\nconst rules: FormInstance['rules'] = {\n  name: [\n    { required: true, message: '请输入姓名' },\n    { maxLength: 4, message: '姓名不超过4个字符' },\n    { match: Regexp.OnlyCh, message: '仅支持中文姓名' }\n  ],\n  phone: [\n    { required: true, message: '请输入手机号' },\n    { match: Regexp.Phone, message: '手机号格式不正确' }\n  ]\n}\n\n/**\n * @description useFormCurd 的特性\n * 1. 能够快速实现表单的新增编辑\n * 2. 能够监视表单的更改，在你点击返回按钮的时候提示：'您确定丢弃更改的内容吗？'\n * 3. 封装思路可作为参考\n */\ntype Form = { id: string; name: string; phone: string }\nconst { form, title, loading, save, saveLoading, back, reset } = useFormCurd<Form>({\n  key: 'id', // 主键\n  formRef: formRef, // 表单的实例对象\n  initApi: initPerson, // 初始化表单字段接口\n  detailApi: () => getPersonById({ id: route.query.id as string }), // 编辑模式下查询详情接口\n  addApi: (form) => addPerson({ ...form, extra: '额外参数-新增' }), // 新增接口\n  editApi: (form) => updatePerson({ ...form, extra: '额外参数-编辑' }), // 编辑接口\n  addToEdit: true, // 新增成功跳到编辑模式\n  onSuccess: (form)=> {\n    console.log('保存成功后的回调函数', form.id)\n  }\n})\n"})])),_:1},8,["loading"])])),_:1},8,["title"])])])}}}),[["__scopeId","data-v-d655569c"]]);export{be as default};
