import{d as e,b as l,R as o,k as a,ab as t,N as d,e as s,o as r,c as i,w as n,h as u,m as p,f,F as c,j as m,B as b,E as v,r as y,G as h,t as _,an as V,a as k,g as w}from"./index-nwng0QS3.js";const g=e({__name:"GiForm",props:{modelValue:{},options:{},columns:{}},emits:["update:modelValue","search","reset"],setup(e,{expose:g,emit:x}){var C;const $=e,q=x,F=l(),j=l((null==(C=$.options.fold)?void 0:C.defaultCollapsed)??!1),E=o({}),B=e=>{var l,o;return e<=((null==(l=$.options.fold)?void 0:l.index)||0)||e>=((null==(o=$.options.fold)?void 0:o.index)||0)&&!j.value},O=e=>{const l={};return"input"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.maxLength=20),"input-number"===e.type&&(l.placeholder=`请输入${e.label}`),"textarea"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.maxLength=200),"select"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.options=E[e.field]||e.options),"cascader"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.options=E[e.field]||e.options),"tree-select"===e.type&&(l.allowClear=!0,l.placeholder=`请输入${e.label}`,l.data=E[e.field]||e.data),"radio-group"===e.type&&(l.options=E[e.field]||e.options),"checkbox-group"===e.type&&(l.options=E[e.field]||e.options),"date-picker"===e.type&&(l.placeholder="请选择日期"),"time-picker"===e.type&&(l.allowClear=!0,l.placeholder="请选择时间"),{...l,...e.props}},R=e=>void 0!==e&&("boolean"==typeof e?e:"function"==typeof e?e($.modelValue):void 0);g({formRef:F}),$.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request($.modelValue).then((l=>{E[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const G=[];$.columns.forEach((e=>{var l;const o=G.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!o.includes(e.field)&&G.push(e)}));const L=a((()=>t($.modelValue)));return d(L,((e,l)=>{G.forEach((o=>{if(e[o.field]!==l[o.field]){$.columns.filter((e=>{var l;return null==(l=null==o?void 0:o.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[o.field])?l.request($.modelValue).then((e=>{E[l.field]=l.resultFormat?l.resultFormat(e):e.data,E[l.field].map((e=>e.value)).includes($.modelValue[l.field])||q("update:modelValue",Object.assign($.modelValue,{[l.field]:""}))})):l.request&&!e[o.field]&&(E[l.field]=[],q("update:modelValue",Object.assign($.modelValue,{[l.field]:""})))}))}}))})),(e,l)=>{const o=s("a-alert"),a=s("a-form-item"),t=s("a-col"),d=s("icon-search"),g=s("a-button"),x=s("icon-up"),C=s("icon-down"),E=s("a-space"),G=s("a-row"),L=s("a-form");return r(),i(L,p({ref_key:"formRef",ref:F,"auto-label-width":!0},e.options.form,{model:e.modelValue}),{default:n((()=>[u(G,p({gutter:14},e.options.row,{class:"w-full"}),{default:n((()=>{var s,F,G;return[(r(!0),f(c,null,m(e.columns,((l,d)=>{return r(),f(c,{key:l.field},[(s=l.hide,void 0!==s&&("boolean"==typeof s?s:"function"==typeof s?s($.modelValue):void 0)?k("",!0):b((r(),i(t,p({key:0,span:l.span||12,ref_for:!0},l.col||l.span?l.col:e.options.col),{default:n((()=>[u(a,p({ref_for:!0},l.item,{label:l.label,field:l.field,rules:l.rules,disabled:R(l.disabled)}),{default:n((()=>[["group-title"].includes(l.type||"")?v(e.$slots,"group-title",{key:1},(()=>[u(o,p({ref_for:!0},l.props),{default:n((()=>[h(_(l.label),1)])),_:2},1040)])):v(e.$slots,l.field,p({key:0,ref_for:!0},{disabled:R(l.disabled)}),(()=>[(r(),i(y(`a-${l.type}`),p({ref_for:!0},O(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return o=e,a=l.field,void q("update:modelValue",Object.assign($.modelValue,{[a]:o}));var o,a}}),null,16,["model-value","onUpdate:modelValue"]))]))])),_:2},1040,["label","field","rules","disabled"])])),_:2},1040,["span"])),[[V,B(d)]]))],64);var s})),128)),(null==(s=e.options.btns)?void 0:s.hide)?k("",!0):(r(),i(t,p({key:0,span:(null==(F=e.options.btns)?void 0:F.span)||12},null==(G=e.options.btns)?void 0:G.col),{default:n((()=>[u(E,{wrap:""},{default:n((()=>[v(e.$slots,"suffix",{},(()=>{var o;return[u(g,{type:"primary",onClick:l[0]||(l[0]=e=>q("search"))},{icon:n((()=>[u(d)])),default:n((()=>{var l;return[h(_((null==(l=e.options.btns)?void 0:l.searchBtnText)||"搜索"),1)]})),_:1}),u(g,{onClick:l[1]||(l[1]=e=>q("reset"))},{default:n((()=>l[3]||(l[3]=[h("重置")]))),_:1}),(null==(o=e.options.fold)?void 0:o.enable)?(r(),i(g,{key:0,type:"text",size:"mini",onClick:l[2]||(l[2]=e=>j.value=!w(j))},{icon:n((()=>[w(j)?(r(),i(C,{key:1})):(r(),i(x,{key:0}))])),default:n((()=>[h(_(w(j)?"展开":"收起"),1)])),_:1})):k("",!0)]}))])),_:3})])),_:3},16,["span"]))]})),_:3},16)])),_:3},16,["model"])}}});export{g as _};
